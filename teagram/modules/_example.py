#                            ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïó‚ñë‚ñë‚ñë‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
#                            ‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ïó‚ñë‚ñà‚ñà‚ïî‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë
#                            ‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ïî‚ïê‚ïù‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñë‚ïö‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ïî‚ïê‚ïù
#                            ‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñë‚ñë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñë‚ñë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñë‚ñë
#                            ‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ïë‚ñë‚ñë‚ñë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
#                            ‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ïö‚ïê‚ïù‚ñë‚ñë‚ñë‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
#                                            https://t.me/itzlayz
#                           
#                                    üîí Licensed under the GNU AGPLv3
#                                 https://www.gnu.org/licenses/agpl-3.0.html

from aiogram.types import (CallbackQuery, InlineKeyboardButton,
                            InlineKeyboardMarkup, InlineQuery,
                            InlineQueryResultArticle, InputTextMessageContent
                            )
from telethon import types

from .. import (  # ".." - —Ç.–∫. –º–æ–¥—É–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ teagram/modules, —Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ
    loader, utils, validators)
from ..types import Config, ConfigValue


# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
# required: –°—é–¥–∞ –ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª

#                 –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ   –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ   –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
#                  –ù–∞–∑–≤–∞–Ω–∏–µ        –ê–≤—Ç–æ—Ä          –í–µ—Ä—Å–∏—è
@loader.module(name="Example", author="teagram", version=1) 
class ExampleMod(loader.Module):  # Example - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –º–æ–¥—É–ª—è
                                  # Mod –≤ –∫–æ–Ω—Ü–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
    """–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è"""

    def __init__(self):
        self.config = Config(
            ConfigValue(
                '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç',        # –ù–∞–∑–≤–∞–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞
                '–î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞', # –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                '–ó–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞',           # –ú–æ–∂–Ω–æ –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                validators.String(),           # –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è
                '–≠—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ'                 # –î–æ–∫—Å—Ç—Ä–∏–Ω–≥/–û–ø–∏—Å–∞–Ω–∏–µ
            )
        )

    async def on_load(self):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω"""
        # –°—é–¥–∞ –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∫–∞–∫–æ–π –Ω–∏–±—É–¥—å —Å–∫—Ä–∏–ø—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–¥ –∏ —Ç.–¥.
        # –ê—Ç—Ä–∏–±—É—Ç—ã: self.db      - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
        #           self.manager - –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–¥—É–ª–µ–π 
        #           self.client  - —Ç–µ–ª–µ–≥—Ä–∞–º –∫–ª–∏–µ–Ω—Ç
        #           self.bot     - –∏–Ω–ª–∞–π–Ω –±–æ—Ç
        # –ò—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–π —á–∞—Å—Ç–∏ –∫–æ–¥–∞ (–í –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–ª–∞—Å—Å–∞)

        # –ó–∞–ø—É—Å—Ç–∏–º —Ü–∏–∫–ª –Ω–∏–∂–µ
        # –≠—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å get_me
        self.testloop.start(testarg='–¢–µ—Å—Ç–æ–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç')
    
    async def on_unload(self):
        """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –º–æ–¥—É–ª—å –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è"""
        # –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–∏–∫–ª—ã —Ç–æ —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ —Ç.–∫. –æ–Ω–∏ —Å–∞–º–∏ –≤—ã–∫–ª—é—á–∞—é—Ç—Å—è
        # –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–∫–∏–µ –Ω–∏–±—É–¥—å –¥–∞—Ç–∞–±–∞–∑—ã —á—Ç–æ–±—ã –Ω–µ –Ω–∞–≤—Ä–µ–¥–∏—Ç—å –∏–º


    # interval - –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    # autostart - True/False (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)
    @loader.loop(5, autostart=False)
    async def testloop(self, testarg): # –¶–∏–∫–ª –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ loop
        """
        –ß—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ü–∏–∫–ª—É, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ 46 —Å—Ç—Ä–æ–∫—É       
        """
        print(testarg)

    # _inline_handler –Ω–∞ –∫–æ–Ω—Ü–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á—Ç–æ–±—ã –æ–±–æ–∑–Ω–∞—á–∏—Ç—å —á—Ç–æ —ç—Ç–æ –∏–Ω–ª–∞–π–Ω-–∫–æ–º–∞–Ω–¥–∞
    # args - –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã. –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç
    async def example_inline_handler(self, inline_query: InlineQuery, args: str):  
        """
        –ü—Ä–∏–º–µ—Ä –∏–Ω–ª–∞–π–Ω-–∫–æ–º–∞–Ω–¥—ã. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: @bot example [–∞—Ä–≥—É–º–µ–Ω—Ç—ã]
        –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–¥–µ —Ç–æ –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥, invoke_inline.
        –ü—Ä–∏–º–µ—Ä –Ω–∏–∂–µ
        """
        await self.new_method(inline_query, args)

    async def new_method(self, inline_query, args):
        await inline_query.answer(
            [
                InlineQueryResultArticle(
                    id=utils.random_id(),
                    title="–¢–∞–π—Ç–ª",
                    description="–ù–∞–∂–º–∏ –Ω–∞ –º–µ–Ω—è!" + (
                        f" –ê—Ä–≥—É–º–µ–Ω—Ç—ã: {args}" if args
                        else ""
                    ),
                    input_message_content=InputTextMessageContent("–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É"),
                    reply_markup=InlineKeyboardMarkup().add(
                        InlineKeyboardButton(
                            "–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏", 
                            callback_data="example_button_callback"
                        )
                    )
                )
            ]
        )
        
    # –°—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–∞–ª–ª–±–µ–∫ –¥–∞—Ç–∞ —Ä–∞–≤–Ω—è–µ—Ç—Å—è "example_button_callback"
    # _callback_handler –Ω–∞ –∫–æ–Ω—Ü–µ —Ñ—É–Ω–∫—Ü–∏–∏ —á—Ç–æ–±—ã –æ–±–æ–∑–Ω–∞—á–∏—Ç—å —á—Ç–æ —ç—Ç–æ –∫–∞–ª–ª–±–µ–∫-—Ö–µ–Ω–¥–ª–µ—Ä
    @loader.on_bot(lambda self, call: call.data == "example_button_callback")  
    async def example_callback_handler(self, call: CallbackQuery):  
        """–ü—Ä–∏–º–µ—Ä –∫–∞–ª–ª–±–µ–∫–∞"""
        await call.answer(
            "–û–≥–æ –ø—Ä–∏–º–µ—Ä –∫–∞–ª–ª–±–µ–∫–∞", show_alert=True)

    # –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –±–µ–∑ –æ–∫–æ–Ω—á–∞–Ω–∏—è _cmd/cmd
    @loader.command()
    async def example(self, message: types.Message, args: str):
        # args —ç—Ç–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥—ã
        # .example [–∞—Ä–≥—É–º–µ–Ω—Ç—ã]
        await utils.answer(message, ('–≠—Ç–æ –ø—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã' + (args or "")))

    # –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–∞–Ω–¥—É —Å –ø–æ–º–æ—â—å—é –æ–∫–æ–Ω—á–∞–Ω–∏—è _cmd/cmd
    async def example_cmd(self, message: types.Message):
        await utils.answer(message, '–≠—Ç–æ –∫–æ–º–∞–Ω–¥–∞ –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä')

    # –¢–∞–∫ –∂–µ –µ—Å—Ç—å –≤–æ—Ç—á–µ—Ä—ã
    # –ò—Ö –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏, –Ω–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏–ø–∏—Å–∫—É "watcher"
    async def watcher(self, message: types.Message):
        await utils.answer(message, '–≠—Ç–æ –≤–æ—Ç—á–µ—Ä —Ç–µ–∞–≥—Ä–∞–º–∞')

        # –¢—É—Ç –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–ª–∞–π–Ω –∫–æ–º–∞–Ω–¥—É –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞
        await self.bot.invoke_inline(
            message,
            'example'
        )